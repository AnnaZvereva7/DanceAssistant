<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>DanceAssistant</title>
    <style>

        body {
            margin: 0; /* отступ вокруг всего тела страницы*/
            font-family: Arial, sans-serif; /* какой текст использовать во всем теле, если нет ариала то ближайший подобный*/
        }

        .user-panel {
            position: fixed;
            top: 16px;
            right: 16px;

        display: flex;
        flex-direction: column;
        align-items: flex-end;

        gap: 8px;

        background: #f9f9f9;
        padding: 12px 16px;
        border: 1px solid #ccc;
        border-radius: 6px;

        font-family: Arial, sans-serif;
        z-index: 1000;
        }

        .user-info {
            text-align: right;
            font-size: 14px;
        }

        .user-info #userName {
            font-weight: bold;
        }

        .user-info #status {
            color: #555;
            font-size: 13px;
        }

        .logout-btn {
            padding: 6px 12px;
            cursor: pointer;
        }

        .container {
            display: flex;
            height: 100vh;
        }

        .left-panel {
            width: 40%;
            border-right: 1px solid #ccc;
            padding: 20px;
            box-sizing: border-box;
            overflow-y: auto;
        }

        .right-panel {
            width: 60%;
            padding: 20px;
            box-sizing: border-box;
            overflow-y: auto;
        }

        button {
            padding: 8px 14px;
            margin: 10px 20px;
            cursor: pointer;
        }

        ul {
            list-style: none;
            padding-left: 0;
            margin-top: 16px;
        }

        li {
            padding: 4px 0;
        }

        a {
            cursor: pointer;
            color: #0066cc;
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }

        label {
            display: block;
            margin-top: 8px;
        }

        select {
            width: 100%;
            padding: 6px;
            margin-top: 4px;
            box-sizing: border-box;
        }

        input, textarea {
            width: 100%;
            padding: 6px;
            box-sizing: border-box;
            margin-top: 4px;
        }

        .hidden {
            display: none;
        }
    </style>
</head>

<body>

<div class="user-panel">
    <div class="user-info">
        <div id="userNameSession">UserName</div>
        <div id="statusSession">Status</div>
    </div>

    <form method="post" action="/logout">
        <button type="submit" class="logout-btn">Logout</button>
    </form>
</div>
<h1>DanceAssistant</h1>
<button id="loadStudentsBtn">Students</button>
<button id="loadLessonsBtn">Lessons</button>
<button id="loadPaymentBtn">Payments</button>
<button id="musicServiceBtn">Music</button>

<div class="container">
    <div class="left-panel">
        <div id="studentsTab" class="hidden">
            <ul id="studentsList"></ul>
        </div>
        <div id="lessonsTab" class="hidden">
            <ul id="lessonsListCompleted"></ul>
            <hr>
            <ul id="lessonsListPlanned"></ul>
        </div>
        <div id="paymentTab" class="hidden">
            <ul id="balanceList"></ul>
        </div>

    </div>
    <div class="right-panel">
        <div id="studentDetails" class="hidden">
            <h3>Student details</h3>
            <label>Student Id:
                <input type="number" id="studentId"></input>
            </label>
            <label>Name:
                <input type="text" id="studentName">
            </label>
            <label>Email:
                <input type="email" id="studentEmail">
            </label>
            <label>Role:
                <select id="studentRole">
                    <option value="BY_REQUEST">BY_REQUEST</option>
                    <option value="PERMANENT">PERMANENT</option>
                    <option value="OLD">OLD</option>
                </select>
            </label>
            <label>Plans:
                <textarea id="studentPlans" rows="6"></textarea>
            </label>
            <label>Schedule:
                <textarea id="studentSchedule"></textarea>
            </label>
            <label>Student Balance:
                <input type="number" id="studentBalance"> </input>
            </label>

            <button id="newLessonBtn">NewLesson</button>
            <button id="newInfoBtn">NewInfo</button>
            <button id="saveChangesStudentBtn">SaveChanges</button>

            <div id="newLessonDetails" class="hidden">
                <h3>New Lesson Details</h3>
                <label>Start Time(01.01.2026 10:00):
                    <input type="text" id="newLessonStartTime">
                </label>
                <label>Duration (minutes):
                    <input type="number" id="newLessonDuration">
                </label>
                <label>Cost (EUR):
                    <input type="number" id="newLessonCost">
                </label>
                <button id="addNewLessonBtn">Add</button>
            </div>
            <div id="newInfoDetails" class="hidden">
                <h3>New Info Details</h3>
                <label>Plans:
                    <textarea id="newStudentInfo" rows="6"></textarea>
                </label>
                <button id="addNewInfoBtn">Add</button>
            </div>
        </div>

        <div id="lessonDetails" class="hidden">
            <h3>Lesson details</h3>
            <label>LessonId:
                <input type="number" id="lessonId">
            </label>
            <label>StudentId:
                <input type="number" id="lessonStudentId" class="hidden">
            </label>
            <label>Student Name:
                <input type="text" id="lessonStudentName">
            </label>
            <label>Lesson Time:
                <textarea id="lessonTime"></textarea>
            </label>
            <label>Duration (minutes):
                <input type="number" id="lessonDuration">
            </label>
            <label>Cost (EUR/per hour):
                <input type="number" id="lessonCost">
            </label>
            <label>Status:
                <textarea id="lessonStatus"></textarea>
            </label>

            <button id="completeLessonBtn">Completed</button>
            <button id="cancelLessonBtn">Cancel</button>
            <button id="saveChangesLessonBtn">Save Changes</button>
            <button id="toStudent">Student Info</button>
        </div>

        <div id="paymentDetails" class="hidden">
            <h3>Payment details</h3>
            <label>
                <input type="hidden" id="studentIdBalance">
            </label>
            <label>StudentName:
                <input type="text" id="student">
            </label>

            <label>Completed Lessons:
                <textarea id="completedLessons" rows="10"> </textarea>
            </label>

            <label>Balance:
                <input type="number" id="balance">
            </label>

            <label>Payment:
                <input type="number" id="payment">
            </label>
            <button id="sendBillBtn">SendBill</button>
            <button id="paidBtn">Paid</button>
        </div>

    </div>
</div>

<script>
    const API_BASE = "http://localhost:8080/trainer"; // поменяйте если другой порт

    /* загрузка списка студентов по кнопке Students */
    document.getElementById("loadStudentsBtn").addEventListener("click", loadStudents);
    /* Показать студентов — скрыть уроки и платежи*/
    document.getElementById("loadStudentsBtn").addEventListener("click", () => {
        document.getElementById("studentsTab").classList.remove("hidden");
        document.getElementById("lessonsTab").classList.add("hidden");
        document.getElementById("lessonDetails").classList.add("hidden");
        document.getElementById("studentDetails").classList.add("hidden");
        document.getElementById("paymentTab").classList.add("hidden");
        document.getElementById("paymentDetails").classList.add("hidden");
    });
    /*выведение на экран формы добавоения нового урока */
    document.getElementById("addNewLessonBtn").addEventListener("click", addLesson);
    document.getElementById("newLessonBtn").addEventListener("click", () => {
        document.getElementById("newLessonDetails").classList.remove("hidden");
        document.getElementById("studentDetails").classList.remove("hidden");
        document.getElementById("newInfoDetails").classList.add("hidden");
    });
    /*todo выведение на экран формы информации(планы и что делали) */
    document.getElementById("addNewInfoBtn").addEventListener("click", addInfo);
    document.getElementById("newInfoBtn").addEventListener("click", () => {
        document.getElementById("newInfoDetails").classList.remove("hidden");
        document.getElementById("studentDetails").classList.remove("hidden");
        document.getElementById("newLessonDetails").classList.add("hidden");
    });
    /*todo сохранение изменений студента */
    document.getElementById("saveChangesStudentBtn").addEventListener("click", saveChangesStudent);
    document.getElementById("saveChangesStudentBtn").addEventListener("click", () => {
        document.getElementById("newInfoDetails").classList.add("hidden");
        document.getElementById("newLessonDetails").classList.add("hidden");
    });

    /*выведение двух списков уроков по кновке Lessons*/
    document.getElementById("loadLessonsBtn").addEventListener("click", loadLessonsCompleted);
    document.getElementById("loadLessonsBtn").addEventListener("click", loadLessonsPlanned);
    /*завершение урока по кнопке Completed*/
    document.getElementById("completeLessonBtn").addEventListener("click", completeLesson);
    /*отмена урока по кнопке Cancel*/
    document.getElementById("cancelLessonBtn").addEventListener("click", cancelLesson);
    /*todo сохранение изменений урока по кнопке SaveChanges*/
    document.getElementById("saveChangesLessonBtn").addEventListener("click", saveChangesLesson);
    /* переход к информации об ученике из урока */
    document.getElementById("toStudent").addEventListener("click", () => {
        const studentId = document.getElementById("lessonStudentId").value;
        loadStudentDetails(studentId);
        document.getElementById("studentDetails").classList.remove("hidden");
        document.getElementById("lessonDetails").classList.add("hidden");
        document.getElementById("newLessonDetails").classList.add("hidden");
        document.getElementById("newInfoDetails").classList.add("hidden");
    });


    /* Показать уроки — скрыть студентов и платежи*/
    document.getElementById("loadLessonsBtn").addEventListener("click", () => {
        document.getElementById("lessonsTab").classList.remove("hidden");
        document.getElementById("studentsTab").classList.add("hidden");
        document.getElementById("paymentTab").classList.add("hidden");
        document.getElementById("studentDetails").classList.add("hidden");
        document.getElementById("lessonDetails").classList.add("hidden");
        document.getElementById("paymentDetails").classList.add("hidden");
        document.getElementById("newLessonDetails").classList.add("hidden");
    });

    /* вкладка с платежами */
    document.getElementById("loadPaymentBtn").addEventListener("click", loadPayments);
     /* Показать платежи — скрыть студентов и уроки*/
    document.getElementById("loadPaymentBtn").addEventListener("click", () => {
        document.getElementById("paymentTab").classList.remove("hidden");
        document.getElementById("studentsTab").classList.add("hidden");
        document.getElementById("studentDetails").classList.add("hidden");
        document.getElementById("lessonDetails").classList.add("hidden");
        document.getElementById("paymentDetails").classList.add("hidden");
        document.getElementById("lessonsTab").classList.add("hidden");
        document.getElementById("newLessonDetails").classList.add("hidden");
    });

    document.getElementById("sendBillBtn").addEventListener("click", sendBill);
    document.getElementById("paidBtn").addEventListener("click", addPayment);




    async function loadStudents() {
    console.log("loadStudents called");
        const list = document.getElementById("studentsList");
        list.innerHTML = "<li>Loading...</li>";
        try {
            const response = await fetch(API_BASE + "/users");
            if (!response.ok) {
                list.innerHTML = "<li>Error loading students</li>";
                return;
            }
            const students = await response.json();
            list.innerHTML = "";
            if (students.length === 0) {
                list.innerHTML = "<li>No students found</li>";
                return;
            }
            students.forEach(student => {
                const li = document.createElement("li");

                const link = document.createElement("a");
                    link.href = "#";                     // Чтобы ссылка не уходила на другую страницу
                 link.textContent = student.id+" - "+student.name;     // Что видит пользователь

                    // При клике → вызываем GET /user/{id}
                    link.addEventListener("click", (e) => {
                        e.preventDefault();
                        loadStudentDetails(student.id);  // <-- вызываем твою функцию загрузки ученика
                     });
                 li.appendChild(link);
                 list.appendChild(li);
            });
        } catch (error) {
            console.error(error);
            list.innerHTML = "<li>Error loading students</li>";
        }
    }


    async function loadStudentDetails(id) {
        try {
            const response = await fetch(API_BASE + "/user/" + id);
            const student = await response.json();
            // Здесь выводим данные на страницу
            document.getElementById("studentName").value = student.name;
            document.getElementById("studentEmail").value = student.email;
            document.getElementById("studentId").value = student.id;
            document.getElementById("studentRole").value = student.role;
            document.getElementById("studentBalance").value = student.balance;
            document.getElementById("studentPlans").value = student.plans;
            document.getElementById("studentSchedule").value = student.schedule;
            // Показываем блок с информацией
            document.getElementById("studentDetails").classList.remove("hidden");
        } catch (error) {
            console.error("Error loading student:", error);
        }
    }


    async function loadLessonsCompleted() {
        const list = document.getElementById("lessonsListCompleted");
        list.innerHTML = "<li>Loading...</li>";
        try {
            const response = await fetch(API_BASE + "/lessons/completed");
            if (!response.ok) {
                list.innerHTML = "<li>Error loading lessons</li>";
                return;
            }
            const lessons = await response.json();
            list.innerHTML = "";
            if (lessons.length === 0) {
                list.innerHTML = "<li>No lessons found</li>";
                return;
            }
            lessons.forEach(lesson => {
                const li = document.createElement("li");
                const link = document.createElement("a");
                    link.href = "#";                     // Чтобы ссылка не уходила на другую страницу
                 link.textContent = lesson.startTime+" " +lesson.studentName+ "("+lesson.id+")";     // Что видит пользователь

                    // При клике → вызываем GET /lesson/{id}
                    link.addEventListener("click", (e) => {
                        e.preventDefault();
                        loadLessonDetails(lesson.id);  // <-- вызываем твою функцию загрузки ученика
                     });
                 li.appendChild(link);
                 list.appendChild(li);
            });
        } catch (error) {
            console.error(error);
            list.innerHTML = "<li>Error loading lessons</li>";
        }
    }


    async function loadLessonsPlanned() {
        const list = document.getElementById("lessonsListPlanned");
        list.innerHTML = "<li>Loading...</li>";
        try {
            const response = await fetch(API_BASE + "/lessons/planned");
            if (!response.ok) {
                list.innerHTML = "<li>Error loading lessons</li>";
                return;
            }
            const lessons = await response.json();
            list.innerHTML = "";
            if (lessons.length === 0) {
                list.innerHTML = "<li>No lessons found</li>";
                return;
            }
            lessons.forEach(lesson => {
                const li = document.createElement("li");
                const link = document.createElement("a");
                    link.href = "#";                     // Чтобы ссылка не уходила на другую страницу
                 link.textContent = lesson.startTime+" " +lesson.studentName+ "("+lesson.id+")";     // Что видит пользователь
                    // При клике → вызываем GET /lesson/{id}
                    link.addEventListener("click", (e) => {
                        e.preventDefault();
                        loadLessonDetails(lesson.id);  // <-- вызываем твою функцию загрузки ученика
                     });
                 li.appendChild(link);
                 list.appendChild(li);
            });
        } catch (error) {
            console.error(error);
            list.innerHTML = "<li>Error loading lessons</li>";
        }
    }


    async function loadLessonDetails(id) {
        try {
            const response = await fetch(API_BASE + "/lesson/" + id);
            const lesson = await response.json();
            // Здесь выводим данные на страницу
            document.getElementById("lessonId").value = lesson.id;
            document.getElementById("lessonStudentName").value = lesson.studentName;
            document.getElementById("lessonStudentId").value = lesson.studentId;
            document.getElementById("lessonTime").value = lesson.startTime;
            document.getElementById("lessonDuration").value = lesson.durationMin;
            document.getElementById("lessonCost").value = lesson.cost;
            document.getElementById("lessonStatus").value = lesson.status;
            // Показываем блок с информацией
            document.getElementById("studentDetails").classList.add("hidden");
            document.getElementById("newLessonDetails").classList.add("hidden");
            document.getElementById("newInfoDetails").classList.add("hidden");
            document.getElementById("lessonDetails").classList.remove("hidden");
        } catch (error) {
            console.error("Error loading lesson:", error);
        }
    }


    async function completeLesson() {
      const csrf = decodeURIComponent(getCookie("XSRF-TOKEN") || "");
        const id = document.getElementById("lessonId").value;
        if (!id) {
            alert("Сначала выберите урок");
            return;
        }
        try {
            const response = await fetch(API_BASE + "/lesson/completed/" + id, {
                method: "PUT",
                credentials: "same-origin",
                headers: {
                    "X-XSRF-TOKEN": csrf
                }
            });
            if (!response.ok) {
                console.error("Error completing lesson:", response.status, response.statusText);
                alert("Не удалось завершить урок");
                return;
            }
        const updatedLesson = await response.json();
        await loadLessonDetails(id);
        alert("Урок отмечен как завершён");
        } catch (error) {
            console.error("Error completing lesson:", error);
            alert("Ошибка при завершении урока");
        }
    }


    async function loadPayments() {
        const list = document.getElementById("balanceList");
        list.innerHTML = "<li>Loading...</li>";
        try {
            const response = await fetch(API_BASE + "/users/balance");
            if (!response.ok) {
                list.innerHTML = "<li>Error loading balances</li>";
                return;
            }
            const payments = await response.json();
            list.innerHTML = "";
            if (payments.length === 0) {
                list.innerHTML = "<li>Active students not found</li>";
                return;
            }
            payments.forEach(payment => {
                const li = document.createElement("li");
                const link = document.createElement("a");
                    link.href = "#";                     // Чтобы ссылка не уходила на другую страницу
                 link.textContent = payment.studentName+"("+payment.studentId+")"+"  " +payment.balance + "EUR";     // Что видит пользователь

                    // При клике → вызываем GET /user/balance/{id}
                    link.addEventListener("click", (e) => {
                        e.preventDefault();
                        loadPaymentDetails(payment.studentId);  // <-- вызываем твою функцию загрузки ученика
                     });
                 li.appendChild(link);
                 list.appendChild(li);
            });
        } catch (error) {
            console.error(error);
            list.innerHTML = "<li>Error loading balances</li>";
        }
    }


    async function loadPaymentDetails(studentId) {
        try {
            const response = await fetch(API_BASE + "/user/balance/" + studentId);
            const paymentInfo = await response.json();
            // Здесь выводим данные на страницу
            document.getElementById("studentIdBalance").value = paymentInfo.studentId;
            document.getElementById("student").value = paymentInfo.studentName;
            document.getElementById("completedLessons").value = (paymentInfo.completedLessons || []).join("\n");
            document.getElementById("balance").value = paymentInfo.balance;
            // Показываем блок с информацией
            document.getElementById("paymentDetails").classList.remove("hidden");
        } catch (error) {
            console.error("Error loading payment details:", error);
        }
    }


    async function sendBill() {
    const id = document.getElementById("studentIdBalance").value;
    if (!id) {
        alert("Сначала выберите ученика");
        return;
    }
    try {
        const response = await fetch(API_BASE + "/user/send_bill/" + id, {
            method: "GET"
        });
        if (!response.ok) {
            console.error("Error:", response.status, response.statusText);
            alert("Не удалось отправить счет");
            return;
        }
        alert("Счет отправлен");
        } catch (error) {
            console.error("Error sending bill:", error);
            alert("Ошибка при отправке счета");
        }
    }


    async function addPayment() {
    const csrf = decodeURIComponent(getCookie("XSRF-TOKEN") || "");
    const id = document.getElementById("studentIdBalance").value;
    let sum = parseInt(document.getElementById("payment").value);
    if (!id) {
        alert("Сначала выберите ученика");
        return;
    }
    try {
        const response = await fetch(API_BASE + "/payment/" + id +"/"+sum, {
            method: "POST",
             credentials: "same-origin",
            headers: {
                "X-XSRF-TOKEN": csrf
            }
        });
        if (!response.ok) {
            console.error("Error:", response.status, response.statusText);
            alert("Не удалось внести оплату");
            return;
        }
        const updatedBalance = await response.json();
        await loadPaymentDetails(id);
        alert("Оплата внесена");
        document.getElementById("payment").value = "";
        } catch (error) {
            console.error("Error sending bill:", error);
            alert("Ошибка при внесении оплаты");
        }
    }


    async function addLesson() {
    const csrf = decodeURIComponent(getCookie("XSRF-TOKEN") || "");
    const id = document.getElementById("studentId").value;
    let startTime = document.getElementById("newLessonStartTime").value;
    let cost = parseInt(document.getElementById("newLessonCost").value);
    let duration = parseInt(document.getElementById("newLessonDuration").value);
    if (!id) {
        alert("Сначала выберите ученика");
        return;
    }
     const lessonData = {
        studentId: Number(id),
        startTime: startTime,
        durationMin: duration,
        cost: cost
    };
    try {
        const response = await fetch(API_BASE + "/lesson/new", {
            method: "POST",
             credentials: "same-origin",
             headers: {
                "Content-Type": "application/json",
                "X-XSRF-TOKEN": csrf
            },
            // 2️⃣ Превращаем объект в JSON-строку
            body: JSON.stringify(lessonData)
        });
        if (!response.ok) {
            console.error("Error:", response.status, response.statusText);
            alert("Не удалось сохранить урок");
            return;
        }
        alert("Урок добавлен");
        } catch (error) {
            console.error("Error sending bill:", error);
            alert("Ошибка при добавлении урока");
        }
    }


    async function cancelLesson() {
    const csrf = decodeURIComponent(getCookie("XSRF-TOKEN") || "");
    const id = document.getElementById("lessonId").value;
    if (!id) {
        alert("Сначала выберите урок");
        return;
    }
    try {
        const response = await fetch(API_BASE + "/lesson/canceled/" + id, {
            method: "PUT",
             credentials: "same-origin",
            headers: {
                "X-XSRF-TOKEN": csrf
            }
        });
        if (!response.ok) {
            console.error("Error canceling lesson:", response.status, response.statusText);
            alert("Не удалось завершить урок");
            return;
        }
        const updatedLesson = await response.json();
        await loadLessonDetails(id);
        alert("Урок отменен");
        } catch (error) {
            console.error("Error canceling lesson:", error);
            alert("Ошибка при отмене урока");
        }
    }


    async function addInfo() {
    const csrf = decodeURIComponent(getCookie("XSRF-TOKEN") || "");
    const id = document.getElementById("studentId").value;
    let infoString = document.getElementById("newStudentInfo").value;
    if (!id) {
        alert("Сначала выберите ученика");
        return;
    }
     const infoData = {
        studentId: Number(id),
        info: infoString
    };
    try {
        const response = await fetch(API_BASE + "/user/new_info", {
            method: "POST",
             credentials: "same-origin",
             headers: {
                "Content-Type": "application/json",
                "X-XSRF-TOKEN": csrf
            },
            // 2️⃣ Превращаем объект в JSON-строку
            body: JSON.stringify(infoData)
        });
        if (!response.ok) {
            console.error("Error:", response.status, response.statusText);
            alert("Не удалось сохранить информацию");
            return;
        }
        alert("Информация добавлена");
        document.getElementById("newStudentInfo").value = "";
        } catch (error) {
            console.error("Error saving info:", error);
            alert("Ошибка при сохранении информации");
        }
    }


    async function saveChangesLesson() {
    const csrf = decodeURIComponent(getCookie("XSRF-TOKEN") || "");
    const id = document.getElementById("lessonId").value;
    let startTime = document.getElementById("lessonTime").value;
    let cost = parseInt(document.getElementById("lessonCost").value);
    let duration = parseInt(document.getElementById("lessonDuration").value);
    if (!id) {
        alert("Сначала выберите урок");
        return;
    }
     const lessonData = {
        lessonId: Number(id),
        startTime: startTime,
        durationInMinutes: duration,
        cost: cost
    };
    try {
        const response = await fetch(API_BASE + "/lesson/change", {
            method: "PUT",
             credentials: "same-origin",
             headers: {
                "Content-Type": "application/json",
                "X-XSRF-TOKEN": csrf
            },
            // 2️⃣ Превращаем объект в JSON-строку
            body: JSON.stringify(lessonData)
        });
        if (!response.ok) {
            console.error("Error:", response.status, response.statusText);
            alert("Не удалось обновить урок");
            return;
        }
        alert("Урок обновлен");

        } catch (error) {
            console.error("Error:", error);
            alert("Ошибка при изменении урока");
        }
    }


    async function saveChangesStudent() {
    const csrf = decodeURIComponent(getCookie("XSRF-TOKEN") || "");
    const id = document.getElementById("studentId").value;
    let name = document.getElementById("studentName").value;
    let email = document.getElementById("studentEmail").value;
    let role = document.getElementById("studentRole").value;
    let schedule = document.getElementById("studentSchedule").value;
    if (!id) {
        alert("Сначала выберите ученика");
        return;
    }
     const studentData = {
        studentId: Number(id),
        name: name,
        email: email,
        role: role,
        schedule: schedule
    };
    console.log("studentData:", studentData);
    try {
        const response = await fetch(API_BASE + "/user/change", {
            method: "PUT",
             credentials: "same-origin",
             headers: {
                "Content-Type": "application/json",
                "X-XSRF-TOKEN": csrf
            },
            // 2️⃣ Превращаем объект в JSON-строку
            body: JSON.stringify(studentData)
        });
        if (!response.ok) {
            console.error("Error:", response.status, response.statusText);
            alert("Не удалось обновить пользователя");
            return;
        }
        alert("Data updated successfully.");

        } catch (error) {
            console.error("Error:", error);
            alert("Ошибка при изменении пользователя");
        }
    }


    function getCookie(name) {
        const m = document.cookie.match(new RegExp("(^| )" + name + "=([^;]+)"));
        return m ? decodeURIComponent(m[2]) : null;
    }

     async function loadMe() {
      const res = await fetch("/api/me");
      if (res.status === 401) {
        window.location.href = "/index.html";
        return;
      }
      const data = await res.json();
      document.getElementById("userNameSession").textContent = data.userName;
      document.getElementById("statusSession").textContent = data.status;
    }

    loadMe();


</script>

</body>
</html>